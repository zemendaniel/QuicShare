<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:QuicFileSharing.GUI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:QuicFileSharing.GUI.Converters"
        xmlns:models="clr-namespace:QuicFileSharing.GUI.Models"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="QuicFileSharing.GUI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="QuicShare"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Window.Resources>
    
    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    
    <Grid Margin="20" VerticalAlignment="Center" HorizontalAlignment="Center">
        <!-- Lobby -->
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                    IsVisible="{Binding State, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static models:AppState.Lobby}}">
            <TextBlock FontWeight="SemiBold" FontSize="24" Margin="0,0,0,20" TextAlignment="Center" Padding="10,5">What would you like to do?</TextBlock>
            <TextBlock FontWeight="Bold" FontSize="20" Margin="0,0,0,12" TextAlignment="Center" Padding="8,4">Join an existing room:</TextBlock>
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center" 
                        Margin="0,0,0,16">
                <TextBox Text="{Binding RoomCode}" 
                         Watermark="Enter your code here..." 
                         Width="300" 
                         TextAlignment="Center"
                         VerticalContentAlignment="Center"
                         VerticalAlignment="Center"
                         Margin="0,0,10,0"
                         Padding="8,4">
                    <TextBox.KeyBindings>
                        <KeyBinding Gesture="Enter" Command="{Binding JoinRoomCommand}"/>
                    </TextBox.KeyBindings>
                </TextBox>
                <Button Content="Join" 
                        Command="{Binding JoinRoomCommand}" 
                        VerticalAlignment="Center"
                        Padding="12,6"/>
            </StackPanel>
            <TextBlock FontWeight="Bold" FontSize="20" Margin="0,0,0,12" TextAlignment="Center" Padding="8,4">Create a new room:</TextBlock>
            <Button HorizontalAlignment="Center" Content="Create Room" Command="{Binding CreateRoomCommand}" Margin="0,0,0,8" Padding="12,6"/>
            <TextBlock Text="{Binding LobbyText}" TextWrapping="Wrap" 
                       Margin="0,0,0,0" Padding="5,3" TextAlignment="Center"/>
            <Button HorizontalAlignment="Center" VerticalAlignment="Bottom" Content="Settings" 
                    Command="{Binding OpenSettingsCommand}" Margin="10" 
                    Padding="12,6"/>
        </StackPanel>
        
        
        <!-- WaitingForConnection -->
        <StackPanel IsVisible="{Binding State, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static models:AppState.WaitingForConnection}}">
            <TextBlock FontWeight="SemiBold" FontSize="24" Margin="0,0,0,8" TextAlignment="Center" Padding="10,5">
                Share this code with your peer:
            </TextBlock>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0, 0, 0, 8">
                <SelectableTextBlock Margin="0, 0, 4, 0" Text="{Binding RoomCode}" FontWeight="Bold" VerticalAlignment="Center"/>
                <Button VerticalAlignment="Center" Command="{Binding CopyRoomCodeCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">Copy to clipboard</Button>
            </StackPanel>
            <TextBlock FontWeight="Light" TextAlignment="Center" FontSize="12" Text="Waiting for incoming connection..."></TextBlock>
        </StackPanel>
        
        <!-- InRoom -->
        <StackPanel IsVisible="{Binding State, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static models:AppState.InRoom}}"
                    VerticalAlignment="Center" HorizontalAlignment="Center">
            <TextBlock FontWeight="SemiBold"
                       FontSize="24"
                       Margin="0,0,0,8"
                       TextAlignment="Center"
                       Padding="10,5"
                       Text="{Binding RoomCode, StringFormat='You are in room: {0}'}"/>
            <Button Content="Send File" HorizontalAlignment="Center" Margin="0,0,0,4" 
                    Command="{Binding SendFileCommand}" 
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                    IsEnabled="{Binding IsTransferInProgress, Converter={StaticResource InverseBoolConverter}}"/>
            <TextBlock FontWeight="Light" FontSize="12" TextAlignment="Center" Margin="0,0,0,20"
                       IsVisible="{Binding IsTransferInProgress, Converter={StaticResource InverseBoolConverter}}">
                You are open to receiving files.
            </TextBlock>
            <TextBlock Text="{Binding RoomText}" TextAlignment="Center"></TextBlock>
            <SelectableTextBlock Text="{Binding FilePath}" TextAlignment="Center"></SelectableTextBlock>
            <StackPanel Orientation="Vertical" Margin="10" Spacing="10" Width="400">
                <ProgressBar Minimum="0" Maximum="100"
                             Value="{Binding ProgressPercentage}" Height="20"/>
                <TextBlock Text="{Binding ProgressText}" FontWeight="Bold"/>
            </StackPanel>
        </StackPanel> 
        
        <!-- Settings -->
        <StackPanel IsVisible="{Binding State, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static models:AppState.Settings}}"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
            <TextBlock FontWeight="SemiBold" FontSize="24" Margin="0,0,0,8" TextAlignment="Center" Padding="10,5">Settings</TextBlock>
            <TextBlock FontWeight="Light" FontSize="12" TextAlignment="Center" Margin="0,0,0,20">
                Leave empty and save to use default values.
            </TextBlock>
            <CheckBox Content="Force IPv4?" IsChecked="{Binding ForceIPv4}" Margin="0,0,0,12"/>
            <TextBlock Margin="0,0,0,8">IPv4 port (1-65535) (if Force IPv4 is enabled):</TextBlock>
            <NumericUpDown Minimum="1" Maximum="65535" Value="{Binding PortV4Text}"
                           IsEnabled="{Binding ForceIPv4}"
                           Increment="1"
                           FormatString="0"
                           Margin="0,0,0,16">
            </NumericUpDown>
            <TextBlock Margin="0,0,0,8">Signaling Server:</TextBlock>
            <TextBox Text="{Binding SignalingServerText}" Margin="0,0,0,16"/>
            <TextBlock Margin="0,0,0,8">IPv6 echo API:</TextBlock>
            <TextBox Text="{Binding ApiV6Text}" Margin="0,0,0,16"/>
            <TextBlock Margin="0,0,0,8">IPv4 echo API</TextBlock>
            <TextBox Text="{Binding ApiV4Text}" Margin="0,0,0,16"/>
            <TextBlock FontWeight="Light" FontSize="12" TextAlignment="Center" Margin="0,0,0,20" TextWrapping="Wrap"
                       MaxWidth="500">
                If you are using your own APIs, make sure that they are working and are accessible. Also make sure that you and
                your peer are using the same signaling server.
            </TextBlock>
            <TextBlock Text="{Binding SettingsText}" MaxWidth="500" TextWrapping="Wrap"></TextBlock>
            <StackPanel Orientation="Horizontal" Spacing="8"  HorizontalAlignment="Center">
                <Button Content="Exit and save" Command="{Binding SaveSettingsCommand}"/>
                <Button Content="Exit without saving" Command="{Binding CloseSettingsCommand}"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
